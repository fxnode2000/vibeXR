<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.5">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="UTF-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;Basic WebXR Scene - Quest 3&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>body {</p>
<p class="p1"><span class="Apple-converted-space">      </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">      </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">      </span>background-color: #87ceeb; /* fallback blue sky */</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>#info {</p>
<p class="p1"><span class="Apple-converted-space">      </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">      </span>top: 10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>left: 10px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-family: sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">      </span>z-index: 1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div id="info"&gt;Use thumbstick on Quest 3 controllers to move around&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script type="module"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.module.js';</p>
<p class="p1"><span class="Apple-converted-space">    </span>import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.154.0/examples/jsm/controls/OrbitControls.js';</p>
<p class="p1"><span class="Apple-converted-space">    </span>import { XRControllerModelFactory } from 'https://cdn.jsdelivr.net/npm/three@0.154.0/examples/jsm/webxr/XRControllerModelFactory.js';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>let camera, scene, renderer;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let controller1, controller2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let controllerGrip1, controllerGrip2;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let moveSpeed = 0.05;</p>
<p class="p1"><span class="Apple-converted-space">    </span>let velocity = new THREE.Vector3();</p>
<p class="p1"><span class="Apple-converted-space">    </span>let tempMatrix = new THREE.Matrix4();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>init();</p>
<p class="p1"><span class="Apple-converted-space">    </span>animate();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function init() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Renderer</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderer = new THREE.WebGLRenderer({ antialias: true });</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderer.setSize(window.innerWidth, window.innerHeight);</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderer.xr.enabled = true;</p>
<p class="p1"><span class="Apple-converted-space">      </span>document.body.appendChild(renderer.domElement);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Scene &amp; Camera</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene = new THREE.Scene();</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene.background = new THREE.Color(0x87ceeb); // blue sky</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Green ground plane 20m x 20m</p>
<p class="p1"><span class="Apple-converted-space">      </span>const groundGeometry = new THREE.PlaneGeometry(20, 20);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const groundMaterial = new THREE.MeshStandardMaterial({ color: 0x228822 });</p>
<p class="p1"><span class="Apple-converted-space">      </span>const ground = new THREE.Mesh(groundGeometry, groundMaterial);</p>
<p class="p1"><span class="Apple-converted-space">      </span>ground.rotation.x = -Math.PI / 2;</p>
<p class="p1"><span class="Apple-converted-space">      </span>ground.receiveShadow = true;</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene.add(ground);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Grey box 2m tall</p>
<p class="p1"><span class="Apple-converted-space">      </span>const boxGeometry = new THREE.BoxGeometry(1, 2, 1);</p>
<p class="p1"><span class="Apple-converted-space">      </span>const boxMaterial = new THREE.MeshStandardMaterial({ color: 0x888888 });</p>
<p class="p1"><span class="Apple-converted-space">      </span>const box = new THREE.Mesh(boxGeometry, boxMaterial);</p>
<p class="p1"><span class="Apple-converted-space">      </span>box.position.set(0, 1, -3); // 1m above ground (half height), 3m in front</p>
<p class="p1"><span class="Apple-converted-space">      </span>box.castShadow = true;</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene.add(box);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Lighting</p>
<p class="p1"><span class="Apple-converted-space">      </span>const light = new THREE.HemisphereLight(0xffffff, 0x444444);</p>
<p class="p1"><span class="Apple-converted-space">      </span>light.position.set(0, 20, 0);</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene.add(light);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const directionalLight = new THREE.DirectionalLight(0xffffff);</p>
<p class="p1"><span class="Apple-converted-space">      </span>directionalLight.position.set(5, 10, 7.5);</p>
<p class="p1"><span class="Apple-converted-space">      </span>directionalLight.castShadow = true;</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene.add(directionalLight);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Controllers</p>
<p class="p1"><span class="Apple-converted-space">      </span>controller1 = renderer.xr.getController(0);</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene.add(controller1);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>controller2 = renderer.xr.getController(1);</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene.add(controller2);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const controllerModelFactory = new XRControllerModelFactory();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>controllerGrip1 = renderer.xr.getControllerGrip(0);</p>
<p class="p1"><span class="Apple-converted-space">      </span>controllerGrip1.add(controllerModelFactory.createControllerModel(controllerGrip1));</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene.add(controllerGrip1);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>controllerGrip2 = renderer.xr.getControllerGrip(1);</p>
<p class="p1"><span class="Apple-converted-space">      </span>controllerGrip2.add(controllerModelFactory.createControllerModel(controllerGrip2));</p>
<p class="p1"><span class="Apple-converted-space">      </span>scene.add(controllerGrip2);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Optional: OrbitControls for desktop testing</p>
<p class="p1"><span class="Apple-converted-space">      </span>const controls = new OrbitControls(camera, renderer.domElement);</p>
<p class="p1"><span class="Apple-converted-space">      </span>controls.target.set(0, 1.6, 0);</p>
<p class="p1"><span class="Apple-converted-space">      </span>controls.update();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>window.addEventListener('resize', onWindowResize);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Start XR session button</p>
<p class="p1"><span class="Apple-converted-space">      </span>document.body.appendChild( VRButton.createButton( renderer ) );</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function onWindowResize() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>camera.aspect = window.innerWidth / window.innerHeight;</p>
<p class="p1"><span class="Apple-converted-space">      </span>camera.updateProjectionMatrix();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>renderer.setSize(window.innerWidth, window.innerHeight);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function animate() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderer.setAnimationLoop(render);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function render() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>handleMovement();</p>
<p class="p1"><span class="Apple-converted-space">      </span>renderer.render(scene, camera);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function handleMovement() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>// Get the input source gamepads (for Quest 3 thumbsticks)</p>
<p class="p1"><span class="Apple-converted-space">      </span>const session = renderer.xr.getSession();</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!session) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const inputSources = session.inputSources;</p>
<p class="p1"><span class="Apple-converted-space">      </span>for (const source of inputSources) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (!source.gamepad) continue;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Thumbstick axes for movement</p>
<p class="p1"><span class="Apple-converted-space">        </span>const axes = source.gamepad.axes;</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (axes.length &gt;= 2) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>// axes[2] and axes[3] could be the second thumbstick,</p>
<p class="p1"><span class="Apple-converted-space">          </span>// but usually left thumbstick is axes[0] and axes[1].</p>
<p class="p1"><span class="Apple-converted-space">          </span>// We'll use axes[0], axes[1].</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>const x = axes[0]; // left/right</p>
<p class="p1"><span class="Apple-converted-space">          </span>const y = axes[1]; // forward/backward</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>// Get the viewer direction to move relative to where the user looks</p>
<p class="p1"><span class="Apple-converted-space">          </span>const xrCamera = renderer.xr.getCamera(camera);</p>
<p class="p1"><span class="Apple-converted-space">          </span>const direction = new THREE.Vector3();</p>
<p class="p1"><span class="Apple-converted-space">          </span>xrCamera.getWorldDirection(direction);</p>
<p class="p1"><span class="Apple-converted-space">          </span>direction.y = 0; // keep movement horizontal</p>
<p class="p1"><span class="Apple-converted-space">          </span>direction.normalize();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>const right = new THREE.Vector3();</p>
<p class="p1"><span class="Apple-converted-space">          </span>right.crossVectors(new THREE.Vector3(0, 1, 0), direction).normalize();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>velocity.set(0, 0, 0);</p>
<p class="p1"><span class="Apple-converted-space">          </span>velocity.addScaledVector(direction, -y * moveSpeed);</p>
<p class="p1"><span class="Apple-converted-space">          </span>velocity.addScaledVector(right, -x * moveSpeed);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>camera.position.add(velocity);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// VRButton helper from three.js to add a "Enter VR" button</p>
<p class="p1"><span class="Apple-converted-space">    </span>import { VRButton } from 'https://cdn.jsdelivr.net/npm/three@0.154.0/examples/jsm/webxr/VRButton.js';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
